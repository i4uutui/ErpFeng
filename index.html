<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dist/dayjs.min.js"></script>
</head>

<body>
  <script>
    const cycles = [
      { "id": 6, "name": "备料组", "sort_date": "1", "cycle": [{ "id": 1, "notice_id": 9, "progress_id": 1, "cycle_id": 6, "end_date": "2025-11-08", "load": null, }, { "id": 7, "notice_id": 9, "progress_id": 2, "cycle_id": 6, "end_date": "2025-11-08", "load": null, }, { "id": 13, "notice_id": 9, "progress_id": 3, "cycle_id": 6, "end_date": "2025-11-08", "load": null, }, { "id": 19, "notice_id": 9, "progress_id": 4, "cycle_id": 6, "end_date": "2025-11-08", "load": null, }], },
      { "id": 8, "name": "热处理", "sort": "3", "sort_date": "2", "cycle": [{ "id": 2, "notice_id": 9, "progress_id": 1, "cycle_id": 8, "end_date": null, "load": null, }, { "id": 8, "notice_id": 9, "progress_id": 2, "cycle_id": 8, "end_date": null, "load": null, }, { "id": 14, "notice_id": 9, "progress_id": 3, "cycle_id": 8, "end_date": null, "load": null, }, { "id": 20, "notice_id": 9, "progress_id": 4, "cycle_id": 8, "end_date": null, "load": null, }], },
      { "id": 9, "name": "研磨组", "sort": "4", "sort_date": "5", "cycle": [{ "id": 3, "notice_id": 9, "progress_id": 1, "cycle_id": 9, "end_date": null, "load": null, }, { "id": 9, "notice_id": 9, "progress_id": 2, "cycle_id": 9, "end_date": null, "load": null, }, { "id": 15, "notice_id": 9, "progress_id": 3, "cycle_id": 9, "end_date": null, "load": null, }, { "id": 21, "notice_id": 9, "progress_id": 4, "cycle_id": 9, "end_date": null, "load": null, }], },
      { "id": 10, "name": "补土组", "sort": "5", "sort_date": "6", "cycle": [{ "id": 4, "notice_id": 9, "progress_id": 1, "cycle_id": 10, "end_date": null, "load": null, }, { "id": 10, "notice_id": 9, "progress_id": 2, "cycle_id": 10, "end_date": null, "load": null, }, { "id": 16, "notice_id": 9, "progress_id": 3, "cycle_id": 10, "end_date": null, "load": null, }, { "id": 22, "notice_id": 9, "progress_id": 4, "cycle_id": 10, "end_date": null, "load": null, }], },
      { "id": 11, "name": "后段组", "sort": "6", "sort_date": "8", "cycle": [{ "id": 5, "notice_id": 9, "progress_id": 1, "cycle_id": 11, "end_date": null, "load": null, }, { "id": 11, "notice_id": 9, "progress_id": 2, "cycle_id": 11, "end_date": null, "load": null, }, { "id": 17, "notice_id": 9, "progress_id": 3, "cycle_id": 11, "end_date": null, "load": null, }, { "id": 23, "notice_id": 9, "progress_id": 4, "cycle_id": 11, "end_date": null, "load": null, }], },
      { "id": 7, "name": "焊接组", "sort": "7", "sort_date": "1", "cycle": [{ "id": 6, "notice_id": 9, "progress_id": 1, "cycle_id": 7, "end_date": null, "load": null, }, { "id": 12, "notice_id": 9, "progress_id": 2, "cycle_id": 7, "end_date": null, "load": null, }, { "id": 18, "notice_id": 9, "progress_id": 3, "cycle_id": 7, "end_date": null, "load": null, }, { "id": 24, "notice_id": 9, "progress_id": 4, "cycle_id": 7, "end_date": null, "load": null, }], }
    ]
    const works = [
      { "id": 1, "progress_id": 1, "notice_id": 9, "bom_id": 78, "child_id": 182, "all_work_time": "75.0", "load": '8.1', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 7, name: "焊接组" } } } },
      { "id": 2, "progress_id": 1, "notice_id": 9, "bom_id": 78, "child_id": 183, "all_work_time": "50.0", "load": '8.1', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 7, name: "焊接组" } } } },
      { "id": 3, "progress_id": 2, "notice_id": 9, "bom_id": 77, "child_id": 181, "all_work_time": "75.0", "load": '8.1', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 7, name: "焊接组" } } } },
      { "id": 4, "progress_id": 3, "notice_id": 9, "bom_id": 64, "child_id": 105, "all_work_time": "75.0", "load": '8.1', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 5, "progress_id": 3, "notice_id": 9, "bom_id": 64, "child_id": 102, "all_work_time": "40.0", "load": '16.2', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 6, "progress_id": 3, "notice_id": 9, "bom_id": 64, "child_id": 106, "all_work_time": "25.0", "load": '16.2', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 7, "progress_id": 3, "notice_id": 9, "bom_id": 64, "child_id": 103, "all_work_time": "40.0", "load": '8.1', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 8, "progress_id": 3, "notice_id": 9, "bom_id": 64, "child_id": 104, "all_work_time": "40.0", "load": '13.0', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 9, "progress_id": 4, "notice_id": 9, "bom_id": 69, "child_id": 146, "all_work_time": "40.0", "load": '8.1', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 10, "progress_id": 4, "notice_id": 9, "bom_id": 69, "child_id": 143, "all_work_time": "50.0", "load": '8.1', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 11, "progress_id": 4, "notice_id": 9, "bom_id": 69, "child_id": 147, "all_work_time": "50.0", "load": '8.1', "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 12, "progress_id": 4, "notice_id": 9, "bom_id": 69, "child_id": 144, "all_work_time": "40.0", "load": null, "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 13, "progress_id": 4, "notice_id": 9, "bom_id": 69, "child_id": 148, "all_work_time": "50.0", "load": null, "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } },
      { "id": 14, "progress_id": 4, "notice_id": 9, "bom_id": 69, "child_id": 145, "all_work_time": "25.0", "load": null, "finish": null, "order_number": "18000", children: { equipment: { cycle: { id: 6, name: "备料组" } } } }
    ]
    /*
  需要计算一下cycles.cycle.load，计算方式为 在works.progress_id等于cycles.cycleprogress_id并且works.children.equipment.cycle.id等于cycles.cycle.id时，则cycles.cycle.load = works.load的累加，如果works.load没有数据，则跳过

  const base = [ { "id": 1, "start_date": "2025-10-28" }, { "id": 2, "start_date": "2025-10-30" }, { "id": 3, "start_date": "2025-10-30" }, { "id": 4, "start_date": "2025-11-01" } ]
  增加base数据,需求增加如下：
  1、cycles.sort_date为最短周期，每次循环cycles时，都需要将之前的周期进行相加，同时假如cycles.cycle.end_date没有日期时，跳过不相加，首次不使用最短周期
  2、以累加后的日期为起点开始累加，之前的不累加
  */
  </script>
</body>

</html>